<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="complex-styles.css" />
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      // 测试数据
      const testData = {
        complex: [
          {
            text: "我经常忘记他人的重要细节，比如生日或名字。",
            example: "",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我经常在谈话中走神，感觉思绪飘到别的地方去了，等回过神来已经错过对方的话。",
            example: "",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我在工作或学习中常因不注意细节而犯粗心错误。比如做题看漏条件、写报告时漏字或出现数值错误。",
            example: "",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我很容易被外部刺激分心，一点声音、动静或手机提示就会让我分神。",
            example: "",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我在集体活动或社交场合中难以保持专注。",
            example: "",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我经常忘记约会、截止日期或其他责任。",
            example: "",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我难以长时间专注于某项任务或活动，比如看书十分钟就开始分心。",
            example: "",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我依赖外部提醒（如闹钟、便签）来保持有条理，如果不设置提醒，就很容易忘记要做的事或开会时间。",
            example: "",
            type: "executive",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我经常开始新的项目，但很少能坚持到底，容易半途而废。一开始充满热情，没过多久就丢在一边不管了。",
            example: "",
            type: "executive",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "面对一堆待办事项时我难以为任务排序，经常感到压力过大，不知道从哪开始，最后拖延不前。",
            example: "",
            type: "executive",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我常常把重要的事拖到最后一刻才去做。明知道要交报告或作业，却总要等到截止前才动手。",
            example: "",
            type: "executive",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我常常难以有效分配时间或低估完成任务所需时间，导致错过截止日期。",
            example: "",
            type: "executive",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我经常在没完成一件事时就转去做另一件，比如写作业写到一半突然去查别的资料或刷手机。",
            example: "",
            type: "executive",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我会回避或拖延需要长时间集中精力的任务。比如要写一篇论文或完成一个大项目时，可能会先刷手机、打扫房间、吃东西来拖延开始的时间。",
            example: "",
            type: "executive",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "因为时间管理不好，我常觉得自己准备不足。比如快要汇报时才发现资料没整理好。",
            example: "",
            type: "executive",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我经常弄丢完成任务所需的物品（比如出门找不到钥匙手机或会议前找不到文件）。",
            example: "",
            type: "executive",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我经常承担太多任务或责任，容易高估自己的时间和精力，一下子答应太多事情，导致最后忙不过来。",
            example: "",
            type: "executive",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我难以按计划执行或达成时间目标，比如列了计划表，但总是完不成。",
            example: "",
            type: "executive",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我难以维持规律的日常作息，睡觉、吃饭、工作时间经常不固定。",
            example: "",
            type: "executive",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我在需要长时间坐着的情况下会感到焦躁或不耐烦, 比如上课、开会或坐车时间太长时就开始扭动身体或想起身活动。",
            example: "",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我在进行休闲活动时，很难安静下来。即使是看书或看剧，也会时不时想起别的事或动来动去。",
            example: "",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我常常感觉自己像被马达驱动一样停不下来。即使没事做，也会主动找事做，不然就会焦虑。",
            example: "",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我常常在别人还没说完时就脱口而出回答或评论，总忍不住想马上说出自己的想法。",
            example: "",
            type: "impulsivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我常常说话过多，即使场合不合适。比如在严肃的会议上也会忍不住多说两句。",
            example: "",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我在等待结果或回应时经常感到强烈的急躁感。比如发消息后总是忍不住反复查看对方是否已读，或者考试成绩快公布了但一直没出时，会特别烦躁、坐立不安。",
            example: "",
            type: "impulsivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我在排队或小组讨论等待发言时感到非常不耐烦、焦躁，想尽快轮到自己。",
            example: "",
            type: "impulsivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我有时会不顾后果地冲动行事。比如一时冲动买了不需要的东西。",
            example: "",
            type: "impulsivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我需要通过身体活动来保持专注。比如边走边想问题时反而思路会更清晰。",
            example: "",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我常常不自觉地踱步、敲打或做重复动作。",
            example: "",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我因为自己认为的失败或错误而感到自卑, 犯了一点错就会反复责备自己，觉得自己不够好。",
            example: "",
            type: "emotional",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我会经历强烈且难以控制的情绪。遇到小事也容易激动、生气或沮丧。",
            example: "",
            type: "emotional",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我经常反复回想发生过的社交场景，担心自己说错或做错了什么。",
            example: "",
            type: "emotional",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "即使知道不应该这么做，我也很难克制冲动或诱惑。比如明知道该工作，却忍不住去刷短视频。",
            example: "",
            type: "emotional",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我在情绪激动时难以找到让自己平静的方法。生气或焦虑时会越想越烦，很难冷静下来。",
            example: "",
            type: "emotional",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我在面对批评或反馈时容易变得防御。别人一指出问题，我就觉得被否定、想解释。",
            example: "",
            type: "emotional",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我难以察觉社交暗示，比如在讲故事或表达观点时，对方已经开始敷衍地笑、看手表、频繁应付，但仍会继续说下去，没有察觉出对方其实想结束话题。",
            example: "",
            type: "emotional",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "由于沟通困难，我有时感到社交孤立或挫败。想表达自己却常被误解，觉得没人懂我。",
            example: "",
            type: "emotional",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我内心常常感到持续的不安或烦躁。明明什么都没发生，却觉得心里一直不踏实。",
            example: "",
            type: "emotional",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我从挫折或负面经历中恢复得很慢。一旦被批评或失败，会心情低落很久。",
            example: "",
            type: "emotional",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我觉得自己的冲动有时会让人际关系变得紧张。情绪化地发脾气后，朋友或同事会疏远我。",
            example: "",
            type: "emotional",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "因为情绪反应强烈，我很难维持良好的人际关系。比如对小误会反应过度，让别人觉得难相处。",
            example: "",
            type: "emotional",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我经常觉得自己被误解或不被认可，觉得别人不了解自己的努力或想法。",
            example: "",
            type: "emotional",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
        ],
      };

      // 主应用组件
      function ADHDComplexTestApp() {
        const [currentPage, setCurrentPage] = useState("home");
        const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
        const [answers, setAnswers] = useState([]);
        const [results, setResults] = useState(null);
        const [randomizedQuestions, setRandomizedQuestions] = useState([]);
        const [originalIndexMap, setOriginalIndexMap] = useState([]);

        // 随机化题目顺序的函数
        const shuffleArray = (array) => {
          const shuffled = [...array];
          for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
          }
          return shuffled;
        };

        const startTest = () => {
          // 创建带索引的题目数组
          const questionsWithIndex = testData.complex.map(
            (question, index) => ({
              ...question,
              originalIndex: index,
            })
          );

          // 随机化题目
          const shuffled = shuffleArray(questionsWithIndex);
          setRandomizedQuestions(shuffled);

          // 创建原始索引映射
          const indexMap = shuffled.map((q) => q.originalIndex);
          setOriginalIndexMap(indexMap);

          setCurrentQuestionIndex(0);
          setAnswers(new Array(testData.complex.length).fill(null));
          setCurrentPage("test");
        };

        const selectAnswer = (value) => {
          const newAnswers = [...answers];
          // 使用原始索引来存储答案
          const originalIndex = originalIndexMap[currentQuestionIndex];
          newAnswers[originalIndex] = value;
          setAnswers(newAnswers);

          // 自动跳转到下一题（延迟300ms让用户看到选择效果）
          setTimeout(() => {
            if (currentQuestionIndex < randomizedQuestions.length - 1) {
              setCurrentQuestionIndex(currentQuestionIndex + 1);
            }
          }, 300);
        };

        const nextQuestion = () => {
          if (currentQuestionIndex < randomizedQuestions.length - 1) {
            setCurrentQuestionIndex(currentQuestionIndex + 1);
          }
        };

        const previousQuestion = () => {
          if (currentQuestionIndex > 0) {
            setCurrentQuestionIndex(currentQuestionIndex - 1);
          }
        };

        const calculateResults = () => {
          const questions = testData.complex;
          let inattentionScore = 0;
          let hyperactivityScore = 0;
          let impulsivityScore = 0;
          let executiveScore = 0;
          let emotionalScore = 0;

          questions.forEach((question, index) => {
            const score = answers[index] || 0;
            switch (question.type) {
              case "inattention":
                inattentionScore += score;
                break;
              case "hyperactivity":
                hyperactivityScore += score;
                break;
              case "impulsivity":
                impulsivityScore += score;
                break;
              case "executive":
                executiveScore += score;
                break;
              case "emotional":
                emotionalScore += score;
                break;
            }
          });

          const totalScore =
            inattentionScore +
            hyperactivityScore +
            impulsivityScore +
            executiveScore +
            emotionalScore;

          setResults({
            total: totalScore,
            inattention: inattentionScore,
            hyperactivity: hyperactivityScore,
            impulsivity: impulsivityScore,
            executive: executiveScore,
            emotional: emotionalScore,
            maxScore: 168, // 42题 × 4分
            maxInattentionScore: 28, // 7题 × 4分
            maxHyperactivityScore: 24, // 6题 × 4分
            maxImpulsivityScore: 16, // 4题 × 4分
            maxExecutiveScore: 48, // 12题 × 4分
            maxEmotionalScore: 52, // 13题 × 4分
          });
          setCurrentPage("results");
        };

        const resetTest = () => {
          setCurrentPage("home");
          setCurrentQuestionIndex(0);
          setAnswers([]);
          setResults(null);
          setRandomizedQuestions([]);
          setOriginalIndexMap([]);
        };

        if (currentPage === "home") {
          return <HomePage onStartTest={startTest} />;
        } else if (currentPage === "test") {
          return (
            <TestPage
              questions={randomizedQuestions}
              currentQuestionIndex={currentQuestionIndex}
              answers={answers}
              originalIndexMap={originalIndexMap}
              onSelectAnswer={selectAnswer}
              onNextQuestion={nextQuestion}
              onPreviousQuestion={previousQuestion}
              onSubmitTest={calculateResults}
              onBackToHome={resetTest}
            />
          );
        } else {
          return <ResultsPage results={results} onBackToHome={resetTest} />;
        }
      }

      // 主页组件
      function HomePage({ onStartTest }) {
        return (
          <div className="container">
            <div className="hero-section">
              <div className="hero-content">
                <h1 className="hero-title">ADHD 专业深度测评</h1>
                <p className="hero-description">
                  基于国际标准临床量表设计的专业ADHD深度评估工具，
                  从注意力与专注困难、执行功能与组织能力、冲动与多动倾向、情绪与自我调节困难四个核心维度全面评估您的ADHD症状特征。
                </p>

                <div className="test-info">
                  <div className="info-card">
                    <h3>📊 四维度专业评估</h3>
                    <ul>
                      <li>注意力与专注困难</li>
                      <li>执行功能与组织能力</li>
                      <li>冲动与多动倾向</li>
                      <li>情绪与自我调节困难</li>
                    </ul>
                  </div>

                  <div className="info-card">
                    <h3>⏱️ 测评信息</h3>
                    <ul>
                      <li>题目数量：42道</li>
                      <li>预估时间：10-15分钟</li>
                      <li>适用年龄：18岁以上成人</li>
                      <li>评分制度：5级评分</li>
                    </ul>
                  </div>

                  <div className="info-card">
                    <h3>🎯 结果分析</h3>
                    <ul>
                      <li>总体ADHD风险评估</li>
                      <li>四个维度详细分析</li>
                      <li>可视化雷达图展示</li>
                      <li>专业建议与指导</li>
                    </ul>
                  </div>
                </div>

                <button className="btn-primary" onClick={onStartTest}>
                  开始专业深度测评
                </button>

                <div style={{ marginTop: "40px" }} className="disclaimer">
                  <p>
                    <strong>⚠️ 重要提示：</strong>
                  </p>
                  <p>
                    此测评仅供参考，不能替代专业医学诊断。如有需要，请咨询专业医疗机构。
                  </p>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // 测试页面组件
      function TestPage({
        questions,
        currentQuestionIndex,
        answers,
        originalIndexMap,
        onSelectAnswer,
        onNextQuestion,
        onPreviousQuestion,
        onSubmitTest,
        onBackToHome,
      }) {
        const currentQuestion = questions[currentQuestionIndex];
        const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
        const isLastQuestion = currentQuestionIndex === questions.length - 1;
        const allAnswered = answers.every((answer) => answer !== null);

        // 获取当前题目的原始索引对应的答案
        const currentOriginalIndex = originalIndexMap
          ? originalIndexMap[currentQuestionIndex]
          : currentQuestionIndex;
        const currentAnswer = answers[currentOriginalIndex];

        return (
          <div className="container">
            <div className="test-header">
              <button className="btn-back" onClick={onBackToHome}>
                ← 返回首页
              </button>
              <div className="progress-info">
                第 {currentQuestionIndex + 1} 题 / 共 {questions.length} 题
              </div>
            </div>

            <div className="progress-container">
              <div className="progress-bar">
                <div
                  className="progress-fill"
                  style={{ width: `${progress}%` }}
                ></div>
              </div>
              <div className="progress-text">{Math.round(progress)}% 完成</div>
            </div>

            <div className="test-content">
              <div className="question-card">
                <div className="question-number">
                  问题 <span>{currentQuestionIndex + 1}</span>
                </div>
                <h2 className="question-text">{currentQuestion.text}</h2>
                {currentQuestion.example && (
                  <div className="question-example">
                    <span className="example-label">💬 例如：</span>
                    {currentQuestion.example}
                  </div>
                )}
                <div className="answer-options">
                  {currentQuestion.options.map((option, index) => (
                    <div
                      key={index}
                      className={`answer-option ${
                        currentAnswer === option.value ? "selected" : ""
                      }`}
                      onClick={() => onSelectAnswer(option.value)}
                    >
                      <input
                        type="radio"
                        name="answer"
                        value={option.value}
                        checked={currentAnswer === option.value}
                        onChange={() => {}}
                      />
                      <label>{option.text}</label>
                    </div>
                  ))}
                </div>
              </div>

              <div className="navigation-buttons">
                <button
                  className="btn-secondary"
                  onClick={onPreviousQuestion}
                  disabled={currentQuestionIndex === 0}
                >
                  上一题
                </button>
                <div className="button-spacer"></div>
                {isLastQuestion ? (
                  <button
                    className="btn-primary"
                    onClick={onSubmitTest}
                    disabled={!allAnswered}
                  >
                    查看结果
                  </button>
                ) : (
                  <button
                    className="btn-primary"
                    onClick={onNextQuestion}
                    disabled={
                      currentAnswer === null || currentAnswer === undefined
                    }
                  >
                    下一题
                  </button>
                )}
              </div>
            </div>
          </div>
        );
      }

      // 结果页面组件
      function ResultsPage({ results, onBackToHome }) {
        const [chartInstance, setChartInstance] = useState(null);

        useEffect(() => {
          createRadarChart();
          return () => {
            if (chartInstance) {
              chartInstance.destroy();
            }
          };
        }, [results]);

        const createRadarChart = () => {
          const canvas = document.getElementById("radarChart");
          if (!canvas) return;

          const ctx = canvas.getContext("2d");

          if (chartInstance) {
            chartInstance.destroy();
          }

          const data = {
            labels: [
              "注意力与专注困难",
              "执行与组织困难",
              "冲动与多动倾向",
              "情绪调节困难",
            ],
            datasets: [
              {
                label: "ADHD维度评估",
                data: [
                  (results.inattention / results.maxInattentionScore) * 100,
                  (results.executive / results.maxExecutiveScore) * 100,
                  ((results.hyperactivity + results.impulsivity) /
                    (results.maxHyperactivityScore +
                      results.maxImpulsivityScore)) *
                    100,
                  (results.emotional / results.maxEmotionalScore) * 100,
                ],
                backgroundColor: "rgba(113, 70, 221, 0.2)",
                borderColor: "#7146dd",
                borderWidth: 2,
                pointBackgroundColor: "#7146dd",
                pointBorderColor: "#fff",
                pointBorderWidth: 2,
                pointRadius: 6,
              },
            ],
          };

          const config = {
            type: "radar",
            data: data,
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                r: {
                  beginAtZero: true,
                  max: 100,
                  ticks: {
                    stepSize: 20,
                    callback: function (value) {
                      return value + "%";
                    },
                  },
                  grid: {
                    color: "rgba(0,0,0,0.1)",
                  },
                  pointLabels: {
                    font: {
                      size: window.innerWidth <= 480 ? 10 : 12,
                      weight: "bold",
                    },
                    padding: window.innerWidth <= 480 ? 12 : 18,
                    display: true,
                  },
                },
              },
              layout: {
                padding: {
                  top: window.innerWidth <= 480 ? 20 : 30,
                  right: window.innerWidth <= 480 ? 20 : 30,
                  bottom: window.innerWidth <= 480 ? 20 : 30,
                  left: window.innerWidth <= 480 ? 20 : 30,
                },
              },
              plugins: {
                legend: {
                  display: false,
                },
              },
            },
          };

          const newChart = new Chart(ctx, config);
          setChartInstance(newChart);
        };

        const getRiskLevel = (percentage) => {
          if (percentage >= 75) return { level: "高风险", class: "high-risk" };
          if (percentage >= 50)
            return { level: "中等风险", class: "medium-risk" };
          if (percentage >= 25) return { level: "轻度风险", class: "low-risk" };
          return { level: "低风险", class: "minimal-risk" };
        };

        // 计算分析结果
        const totalPercentage = (results.total / results.maxScore) * 100;
        const analysis = getComplexResultAnalysis(results, totalPercentage);
        const scoreInterpretation = getComplexScoreInterpretation(
          results.total,
          results.maxScore
        );
        const personalizedAnalysis = getComplexPersonalizedAnalysis(results);

        const dimensionResults = [
          {
            name: "注意力与专注困难",
            description: "专注力持久性、细节关注能力、任务完成度",
            score: results.inattention,
            maxScore: results.maxInattentionScore,
            percentage:
              (results.inattention / results.maxInattentionScore) * 100,
          },
          {
            name: "执行与组织困难",
            description: "计划组织能力、时间管理、任务切换灵活性",
            score: results.executive,
            maxScore: results.maxExecutiveScore,
            percentage: (results.executive / results.maxExecutiveScore) * 100,
          },
          {
            name: "冲动与多动倾向",
            description: "身体活动控制、行为抑制能力、冲动决策控制",
            score: results.hyperactivity + results.impulsivity,
            maxScore:
              results.maxHyperactivityScore + results.maxImpulsivityScore,
            percentage:
              ((results.hyperactivity + results.impulsivity) /
                (results.maxHyperactivityScore + results.maxImpulsivityScore)) *
              100,
          },
          {
            name: "情绪调节困难",
            description: "情绪管理能力、社交技能、自我认知与调节",
            score: results.emotional,
            maxScore: results.maxEmotionalScore,
            percentage: (results.emotional / results.maxEmotionalScore) * 100,
          },
        ];

        // 调试信息
        console.log("Dimension Results:", dimensionResults);
        dimensionResults.forEach((dim, index) => {
          console.log(
            `${dim.name}: ${dim.score}/${dim.maxScore} = ${dim.percentage}%`
          );
        });

        return (
          <div className="container">
            <div className="page active">
              <div className="result-header">
                <button className="btn-back" onClick={onBackToHome}>
                  ← 重新测试
                </button>
              </div>

              <div className="result-content">
                <div className="result-card">
                  <div className="result-score">
                    <div className="score-card">
                      <div className="score-label">测试总分</div>
                      <div className="score-main">
                        <span className="current-score">{results.total}</span>
                        <span className="score-separator">/</span>
                        <span className="max-score">{results.maxScore}</span>
                      </div>
                      <div className="score-percentage">
                        {Math.round(totalPercentage)}%
                      </div>
                    </div>
                  </div>

                  <div className="result-level">
                    <h2 className="level-title">{analysis.level}</h2>
                    <p className="level-description">{analysis.description}</p>
                  </div>

                  <div className="result-details">
                    <h3>详细分析</h3>

                    <div className="score-interpretation">
                      <h4>分数解读</h4>
                      <div
                        className="interpretation-content"
                        dangerouslySetInnerHTML={{
                          __html: scoreInterpretation,
                        }}
                      ></div>
                    </div>

                    <div className="radar-chart-container">
                      <h4>四维度雷达图分析</h4>
                      <div className="chart-wrapper">
                        <canvas id="radarChart"></canvas>
                      </div>
                      <p className="chart-description">
                        雷达图展示了您在ADHD四个核心维度上的表现情况，数值越高表示该维度的症状越明显。
                      </p>
                    </div>

                    <div className="symptom-analysis">
                      {dimensionResults.map((dimension, index) => {
                        const risk = getRiskLevel(dimension.percentage);
                        return (
                          <div key={index} className="symptom-category">
                            <h4>{dimension.name}</h4>
                            <div className="symptom-score">
                              <span className="score-display">
                                {dimension.score} / {dimension.maxScore} 分
                              </span>
                            </div>
                            <div className="score-bar">
                              <div
                                className="score-fill"
                                style={{
                                  width: `${Math.min(
                                    100,
                                    Math.max(0, dimension.percentage || 0)
                                  )}%`,
                                }}
                              ></div>
                            </div>
                            <div className="symptom-interpretation">
                              得分 {Math.round(dimension.percentage)}% -{" "}
                              {risk.level}
                              <br />
                              {dimension.description}
                            </div>
                          </div>
                        );
                      })}
                    </div>

                    <div className="personalized-analysis">
                      <h4>个性化分析</h4>
                      <div
                        className="personalized-content"
                        dangerouslySetInnerHTML={{
                          __html: personalizedAnalysis,
                        }}
                      ></div>
                    </div>

                    <div className="recommendations">
                      <h4>专业建议</h4>
                      <div
                        className="recommendation-content"
                        dangerouslySetInnerHTML={{
                          __html: analysis.recommendations,
                        }}
                      ></div>
                    </div>
                  </div>

                  <div className="result-actions">
                    <button className="btn-primary" onClick={onBackToHome}>
                      重新测试
                    </button>
                    <button
                      className="btn-secondary"
                      onClick={() => window.print()}
                    >
                      保存结果
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // 复杂版分析函数
      function getComplexResultAnalysis(results, totalPercentage) {
        if (totalPercentage <= 30) {
          return {
            level: "低风险",
            description:
              "当前症状表现较轻微，成人ADHD的可能性较低。您在注意力、执行功能、冲动控制和情绪调节方面基本正常。",
            recommendations: `
              <ul>
                <li>保持良好的工作和生活习惯</li>
                <li>使用时间管理工具提高效率</li>
                <li>定期进行体育锻炼缓解压力</li>
                <li>保证充足的睡眠和合理的营养</li>
                <li>继续关注自我状态，保持良好的心理健康</li>
              </ul>
            `,
          };
        } else if (totalPercentage <= 60) {
          return {
            level: "中等风险",
            description:
              "存在一定程度的ADHD相关症状，建议关注这些症状对日常生活的影响，可考虑咨询专业医生进行评估。",
            recommendations: `
              <ul>
                <li><strong>建议咨询精神科医生或心理医生</strong></li>
                <li>使用任务管理App和提醒工具</li>
                <li>创建无干扰的工作环境</li>
                <li>学习正念冥想和放松技巧</li>
                <li>建立规律的日常作息</li>
                <li>与家人朋友分享您的困扰，获得支持</li>
                <li>考虑参加ADHD管理技能培训</li>
              </ul>
            `,
          };
        } else {
          return {
            level: "高风险",
            description:
              "症状表现明显，强烈建议咨询专业医生进行全面评估。成人ADHD如果得到适当治疗，可以显著改善生活质量。",
            recommendations: `
              <ul>
                <li><strong>请尽快咨询精神科医生进行专业评估</strong></li>
                <li>准备详细的症状历史和功能影响记录</li>
                <li>了解成人ADHD的治疗选项（药物和非药物治疗）</li>
                <li>考虑认知行为治疗(CBT)等心理治疗</li>
                <li>寻找ADHD支持小组或在线社区</li>
                <li>学习ADHD管理策略和生活技能</li>
                <li>向雇主了解工作场所的合理调整政策</li>
                <li>制定个人化的症状管理计划</li>
              </ul>
            `,
          };
        }
      }

      function getComplexScoreInterpretation(total, maxScore) {
        const percentage = Math.round((total / maxScore) * 100);

        let interpretation = `<p><strong>您的总分为 ${total} 分（满分 ${maxScore} 分），占总分的 ${percentage}%</strong></p>`;

        interpretation += `
          <div class="score-ranges">
            <div class="score-range ${
              total <= Math.round(maxScore * 0.3) ? "current" : ""
            }">
              <span class="range">0-${Math.round(maxScore * 0.3)}分</span>
              <span class="level low-risk">低风险</span>
              <span class="desc">症状轻微，ADHD可能性较低</span>
            </div>
            <div class="score-range ${
              total > Math.round(maxScore * 0.3) &&
              total <= Math.round(maxScore * 0.6)
                ? "current"
                : ""
            }">
              <span class="range">${
                Math.round(maxScore * 0.3) + 1
              }-${Math.round(maxScore * 0.6)}分</span>
              <span class="level medium-risk">中等风险</span>
              <span class="desc">存在明显症状，建议专业评估</span>
            </div>
            <div class="score-range ${
              total > Math.round(maxScore * 0.6) ? "current" : ""
            }">
              <span class="range">${
                Math.round(maxScore * 0.6) + 1
              }-${maxScore}分</span>
              <span class="level high-risk">高风险</span>
              <span class="desc">症状显著，强烈建议就医</span>
            </div>
          </div>
        `;

        return interpretation;
      }

      function getComplexPersonalizedAnalysis(results) {
        let analysis = [];

        // 找出最突出的维度
        const dimensions = [
          {
            name: "注意力与专注困难",
            score: results.inattention,
            max: results.maxInattentionScore,
          },
          {
            name: "执行与组织困难",
            score: results.executive,
            max: results.maxExecutiveScore,
          },
          {
            name: "冲动与多动倾向",
            score: results.hyperactivity + results.impulsivity,
            max: results.maxHyperactivityScore + results.maxImpulsivityScore,
          },
          {
            name: "情绪调节困难",
            score: results.emotional,
            max: results.maxEmotionalScore,
          },
        ];

        const percentages = dimensions.map((d) => ({
          ...d,
          percentage: (d.score / d.max) * 100,
        }));
        const sortedDimensions = percentages.sort(
          (a, b) => b.percentage - a.percentage
        );

        const highest = sortedDimensions[0];
        const lowest = sortedDimensions[3];

        if (highest.percentage >= 60) {
          analysis.push(
            `<span class="highlight">${
              highest.name
            }</span>是您最突出的表现，得分达到${Math.round(
              highest.percentage
            )}%，这可能对您的日常生活产生显著影响。`
          );
        } else if (highest.percentage >= 40) {
          analysis.push(
            `<span class="highlight">${
              highest.name
            }</span>是相对突出的维度，得分为${Math.round(
              highest.percentage
            )}%，需要特别关注。`
          );
        }

        if (highest.percentage - lowest.percentage >= 30) {
          analysis.push(
            `您在不同维度上的表现<span class="highlight">差异较大</span>，${highest.name}明显高于${lowest.name}，这种不均衡的模式有助于制定针对性的管理策略。`
          );
        } else {
          analysis.push(
            `您在四个维度上的表现<span class="highlight">相对均衡</span>，这表明您可能需要全面的管理方法。`
          );
        }

        // 功能影响评估
        const totalPercentage = (results.total / results.maxScore) * 100;
        if (totalPercentage > 60) {
          analysis.push(
            `这些症状很可能已经对您的工作、学习或人际关系造成了<span class="highlight">显著影响</span>，建议寻求专业支持。`
          );
        } else if (totalPercentage > 30) {
          analysis.push(
            `这些症状可能在某些情况下对您的日常生活造成<span class="highlight">一定影响</span>，适当的策略调整会有帮助。`
          );
        }

        return analysis.join("<br><br>");
      }

      // 渲染应用
      ReactDOM.render(<ADHDComplexTestApp />, document.getElementById("root"));
    </script>
  </body>
</html>
