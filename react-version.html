<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ADHD自测量表 - React版</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      // 测试题目数据
      const testData = {
        children: [
          // 注意力不集中症状 (1-9)
          {
            text: "孩子在学习、工作或其他活动中，经常无法注意到细节或因粗心而犯错",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "孩子在做功课或游戏时，经常难以保持注意力",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "别人对孩子说话时，孩子经常看起来没在听",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "孩子经常不能按照指令完成功课、家务或工作职责",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "孩子经常在组织任务和活动方面有困难",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "孩子经常回避、不喜欢或不愿意参加需要持续精神努力的任务",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "孩子经常遗失任务或活动所需的物品",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "孩子经常容易被外界刺激分散注意力",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "孩子在日常活动中经常健忘",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          // 多动冲动症状 (10-18)
          {
            text: "孩子经常手脚动个不停或在座位上扭来扭去",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "在需要保持坐着的场合，孩子经常离开座位",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "孩子经常在不适当的场合跑来跑去或爬上爬下",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "孩子经常无法安静地参加游戏或休闲活动",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "孩子经常处于活跃状态，好像'有马达在推动'",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "孩子经常话太多",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "问题还没说完，孩子经常脱口说出答案",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "孩子经常无法等待轮到自己",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
          {
            text: "孩子经常打断或干扰别人的活动",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "偶尔", value: 1 },
              { text: "经常", value: 2 },
              { text: "总是", value: 3 },
            ],
          },
        ],
        adult: [
          // 注意力不集中症状
          {
            text: "我很难专注于工作或任务的细节，经常出现粗心的错误",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我很难在工作或娱乐活动中保持注意力",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "当有人直接对我说话时，我似乎没有在听",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我经常无法完成工作、家务或其他职责",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我在组织任务和活动方面有困难",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我避免、不喜欢或不愿意进行需要持续精神努力的任务",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我经常遗失工作或活动所需的物品",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我容易被外界刺激分散注意力",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我在日常活动中经常健忘",
            type: "inattention",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          // 多动冲动症状
          {
            text: "我在座位上坐立不安，摆弄手脚",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "在需要保持坐着的情况下，我感到不安或想要起来走动",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我感到过度活跃和被驱使去做事情",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我很难安静地参加休闲活动或娱乐活动",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我说话过多",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "问题还没问完，我就脱口说出答案",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我很难等待轮到自己",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我经常打断或干扰别人",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
          {
            text: "我很难放松和冷静下来",
            type: "hyperactivity",
            options: [
              { text: "从不", value: 0 },
              { text: "很少", value: 1 },
              { text: "有时", value: 2 },
              { text: "经常", value: 3 },
              { text: "总是", value: 4 },
            ],
          },
        ],
      };

      // 主应用组件
      function ADHDTestApp() {
        const [currentPage, setCurrentPage] = useState("home");
        const [testType, setTestType] = useState(null);
        const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
        const [answers, setAnswers] = useState([]);
        const [results, setResults] = useState(null);

        const startTest = (type) => {
          setTestType(type);
          setCurrentQuestionIndex(0);
          setAnswers(new Array(testData[type].length).fill(null));
          setCurrentPage("test");
        };

        const selectAnswer = (value) => {
          const newAnswers = [...answers];
          newAnswers[currentQuestionIndex] = value;
          setAnswers(newAnswers);
        };

        const nextQuestion = () => {
          if (currentQuestionIndex < testData[testType].length - 1) {
            setCurrentQuestionIndex(currentQuestionIndex + 1);
          }
        };

        const previousQuestion = () => {
          if (currentQuestionIndex > 0) {
            setCurrentQuestionIndex(currentQuestionIndex - 1);
          }
        };

        const calculateResults = () => {
          const questions = testData[testType];
          let inattentionScore = 0;
          let hyperactivityScore = 0;

          questions.forEach((question, index) => {
            const score = answers[index] || 0;
            if (question.type === "inattention") {
              inattentionScore += score;
            } else {
              hyperactivityScore += score;
            }
          });

          const totalScore = inattentionScore + hyperactivityScore;
          const maxScore = testType === "children" ? 54 : 72;
          const maxInattentionScore = testType === "children" ? 27 : 36;
          const maxHyperactivityScore = testType === "children" ? 27 : 36;

          setResults({
            total: totalScore,
            inattention: inattentionScore,
            hyperactivity: hyperactivityScore,
            maxScore,
            maxInattentionScore,
            maxHyperactivityScore,
          });
          setCurrentPage("results");
        };

        const resetTest = () => {
          setCurrentPage("home");
          setTestType(null);
          setCurrentQuestionIndex(0);
          setAnswers([]);
          setResults(null);
        };

        if (currentPage === "home") {
          return <HomePage onStartTest={startTest} />;
        } else if (currentPage === "test") {
          return (
            <TestPage
              testType={testType}
              questions={testData[testType]}
              currentQuestionIndex={currentQuestionIndex}
              answers={answers}
              onSelectAnswer={selectAnswer}
              onNextQuestion={nextQuestion}
              onPreviousQuestion={previousQuestion}
              onSubmitTest={calculateResults}
              onBackToHome={resetTest}
            />
          );
        } else if (currentPage === "results") {
          return (
            <ResultsPage
              testType={testType}
              results={results}
              onRetakeTest={resetTest}
            />
          );
        }
      }

      // 首页组件
      function HomePage({ onStartTest }) {
        return (
          <div className="container">
            <div className="page active">
              <div className="hero">
                <div className="hero-content">
                  <h1 className="hero-title">ADHD自测量表</h1>
                  <p className="hero-subtitle">
                    基于国际标准医学量表，提供专业的ADHD初步筛查
                  </p>
                  <div className="disclaimer">
                    <p>
                      <strong>重要声明：</strong>
                      本测试仅用于初步筛查，不能替代专业医学诊断。如有疑虑，请咨询专业医生。
                    </p>
                  </div>
                </div>
              </div>

              <div className="test-selection">
                <h2>请选择适合的测试版本</h2>
                <div className="test-cards">
                  <div
                    className="test-card"
                    onClick={() => onStartTest("children")}
                  >
                    <div className="card-icon">👶</div>
                    <h3>儿童版</h3>
                    <p>适用年龄：6-18岁</p>
                    <p className="card-description">
                      基于ADHD-RS量表，包含18个核心症状评估项目
                    </p>
                    <button className="btn-primary">开始测试</button>
                  </div>

                  <div
                    className="test-card"
                    onClick={() => onStartTest("adult")}
                  >
                    <div className="card-icon">👤</div>
                    <h3>成人版</h3>
                    <p>适用年龄：18岁以上</p>
                    <p className="card-description">
                      基于成人ADHD自评量表(ASRS)，评估成年期ADHD症状
                    </p>
                    <button className="btn-primary">开始测试</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // 测试页面组件
      function TestPage({
        testType,
        questions,
        currentQuestionIndex,
        answers,
        onSelectAnswer,
        onNextQuestion,
        onPreviousQuestion,
        onSubmitTest,
        onBackToHome,
      }) {
        const currentQuestion = questions[currentQuestionIndex];
        const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
        const isLastQuestion = currentQuestionIndex === questions.length - 1;
        const hasAnswer =
          answers[currentQuestionIndex] !== null &&
          answers[currentQuestionIndex] !== undefined;
        const allAnswered = answers.every(
          (answer) => answer !== null && answer !== undefined
        );

        return (
          <div className="container">
            <div className="page active">
              <div className="test-header">
                <button className="btn-back" onClick={onBackToHome}>
                  ← 返回首页
                </button>
                <div className="progress-container">
                  <div className="progress-bar">
                    <div
                      className="progress-fill"
                      style={{ width: `${progress}%` }}
                    ></div>
                  </div>
                  <span className="progress-text">
                    {currentQuestionIndex + 1} / {questions.length}
                  </span>
                </div>
              </div>

              <div className="test-content">
                <div className="question-card">
                  <div className="question-number">
                    问题 <span>{currentQuestionIndex + 1}</span>
                  </div>
                  <h2 className="question-text">{currentQuestion.text}</h2>
                  <div className="answer-options">
                    {currentQuestion.options.map((option, index) => (
                      <div
                        key={index}
                        className={`answer-option ${
                          answers[currentQuestionIndex] === option.value
                            ? "selected"
                            : ""
                        }`}
                        onClick={() => onSelectAnswer(option.value)}
                      >
                        <input
                          type="radio"
                          name="answer"
                          value={option.value}
                          checked={
                            answers[currentQuestionIndex] === option.value
                          }
                          onChange={() => {}}
                        />
                        <label>{option.text}</label>
                      </div>
                    ))}
                  </div>
                </div>

                <div className="test-navigation">
                  <button
                    className="btn-secondary"
                    onClick={onPreviousQuestion}
                    disabled={currentQuestionIndex === 0}
                  >
                    上一题
                  </button>
                  {isLastQuestion ? (
                    <button
                      className="btn-primary"
                      onClick={onSubmitTest}
                      disabled={!allAnswered}
                    >
                      查看结果
                    </button>
                  ) : (
                    <button
                      className="btn-primary"
                      onClick={onNextQuestion}
                      disabled={!hasAnswer}
                    >
                      下一题
                    </button>
                  )}
                </div>
              </div>
            </div>
          </div>
        );
      }

      // 结果页面组件
      // 雷达图组件
      function RadarChart({ testType, results }) {
        const chartRef = React.useRef(null);
        const chartInstance = React.useRef(null);

        // 计算各维度数据
        const {
          inattention,
          hyperactivity,
          maxInattentionScore,
          maxHyperactivityScore,
        } = results;

        let data, labels;

        if (testType === "children") {
          // 儿童版：注意力不集中、多动冲动、执行功能、情绪调节、社交技能
          const executiveScore = Math.round(
            (inattention + hyperactivity) * 0.3
          ); // 基于注意力和多动推算
          const emotionalScore = Math.round(hyperactivity * 0.8); // 基于多动推算
          const socialScore = Math.round((inattention + hyperactivity) * 0.25); // 基于整体症状推算

          labels = [
            "注意力集中",
            "冲动控制",
            "执行功能",
            "情绪调节",
            "社交技能",
          ];
          data = [
            Math.round((1 - inattention / maxInattentionScore) * 100), // 反向计算，分数越高能力越强
            Math.round((1 - hyperactivity / maxHyperactivityScore) * 100),
            Math.max(0, 100 - executiveScore),
            Math.max(0, 100 - emotionalScore),
            Math.max(0, 100 - socialScore),
          ];
        } else {
          // 成人版：注意力、多动性、冲动性、执行功能、时间管理
          const executiveScore = Math.round(
            (inattention + hyperactivity) * 0.35
          );
          const timeManagementScore = Math.round(inattention * 0.9);

          labels = [
            "注意力集中",
            "活动控制",
            "冲动控制",
            "执行功能",
            "时间管理",
          ];
          data = [
            Math.round((1 - inattention / maxInattentionScore) * 100),
            Math.round((1 - hyperactivity / maxHyperactivityScore) * 100),
            Math.round((1 - hyperactivity / maxHyperactivityScore) * 100),
            Math.max(0, 100 - executiveScore),
            Math.max(0, 100 - timeManagementScore),
          ];
        }

        React.useEffect(() => {
          if (chartRef.current) {
            // 销毁之前的图表实例
            if (chartInstance.current) {
              chartInstance.current.destroy();
            }

            const ctx = chartRef.current.getContext("2d");

            chartInstance.current = new Chart(ctx, {
              type: "radar",
              data: {
                labels: labels,
                datasets: [
                  {
                    label: "能力水平",
                    data: data,
                    backgroundColor: "rgba(79, 172, 254, 0.15)",
                    borderColor: "rgba(79, 172, 254, 1)",
                    borderWidth: 2,
                    pointBackgroundColor: "rgba(79, 172, 254, 1)",
                    pointBorderColor: "#fff",
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    pointHoverBackgroundColor: "#fff",
                    pointHoverBorderColor: "rgba(79, 172, 254, 1)",
                    pointHoverRadius: 6,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                layout: {
                  padding: 20,
                },
                plugins: {
                  legend: {
                    display: false,
                  },
                  tooltip: {
                    callbacks: {
                      title: function (tooltipItems) {
                        return tooltipItems[0].label;
                      },
                      label: function (tooltipItem) {
                        return "能力水平: " + tooltipItem.raw + "%";
                      },
                    },
                  },
                },
                scales: {
                  r: {
                    beginAtZero: true,
                    max: 100,
                    min: 0,
                    ticks: {
                      stepSize: 25,
                      display: false, // 隐藏数字刻度
                      backdropColor: "transparent",
                    },
                    grid: {
                      color: "rgba(0, 0, 0, 0.08)",
                      lineWidth: 1,
                    },
                    angleLines: {
                      color: "rgba(0, 0, 0, 0.08)",
                      lineWidth: 1,
                    },
                    pointLabels: {
                      font: {
                        size: 13,
                        family: "Inter, sans-serif",
                        weight: "500",
                      },
                      color: "#2d3748",
                      padding: 15,
                    },
                  },
                },
              },
            });
          }
        }, [testType, results, labels, data]);

        return (
          <div className="radar-chart-container">
            <h4>能力分析雷达图</h4>
            <div className="chart-wrapper">
              <canvas ref={chartRef}></canvas>
            </div>

            {/* 数据表格 */}
            <div className="chart-data-table">
              <table>
                <thead>
                  <tr>
                    <th>能力维度</th>
                    <th>水平评分</th>
                    <th>能力状态</th>
                  </tr>
                </thead>
                <tbody>
                  {labels.map((label, index) => (
                    <tr key={index}>
                      <td className="dimension-name">{label}</td>
                      <td className="score-value">{data[index]}%</td>
                      <td className="status-indicator">
                        <span
                          className={`status-badge ${
                            data[index] >= 70
                              ? "status-good"
                              : data[index] >= 40
                              ? "status-medium"
                              : "status-low"
                          }`}
                        >
                          {data[index] >= 70
                            ? "良好"
                            : data[index] >= 40
                            ? "一般"
                            : "待提升"}
                        </span>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            <p className="chart-note">
              * 图表显示各项能力的相对水平，可点击数据点查看具体数值
            </p>
          </div>
        );
      }

      function ResultsPage({ testType, results, onRetakeTest }) {
        const {
          total,
          inattention,
          hyperactivity,
          maxScore,
          maxInattentionScore,
          maxHyperactivityScore,
        } = results;

        // 计算分析结果
        const analysis = getResultAnalysis(testType, results);
        const scoreInterpretation = getScoreInterpretation(
          testType,
          total,
          maxScore
        );
        const personalizedAnalysis = getPersonalizedAnalysis(testType, results);

        const inattentionPercentage = (inattention / maxInattentionScore) * 100;
        const hyperactivityPercentage =
          (hyperactivity / maxHyperactivityScore) * 100;

        return (
          <div className="container">
            <div className="page active">
              <div className="result-header">
                <button className="btn-back" onClick={onRetakeTest}>
                  ← 重新测试
                </button>
              </div>

              <div className="result-content">
                <div className="result-card">
                  <div className="result-score">
                    <div className="score-card">
                      <div className="score-label">测试总分</div>
                      <div className="score-main">
                        <span className="current-score">{total}</span>
                        <span className="score-separator">/</span>
                        <span className="max-score">{maxScore}</span>
                      </div>
                      <div className="score-percentage">
                        {Math.round((total / maxScore) * 100)}%
                      </div>
                    </div>
                  </div>

                  <div className="result-level">
                    <h2 className="level-title">{analysis.level}</h2>
                    <p className="level-description">{analysis.description}</p>
                  </div>

                  <div className="result-details">
                    <h3>详细分析</h3>

                    <div className="score-interpretation">
                      <h4>分数解读</h4>
                      <div
                        className="interpretation-content"
                        dangerouslySetInnerHTML={{
                          __html: scoreInterpretation,
                        }}
                      ></div>
                    </div>

                    <div className="symptom-analysis">
                      <div className="symptom-category">
                        <h4>注意力不集中症状</h4>
                        <div className="symptom-score">
                          <span className="score-display">
                            {inattention} / {maxInattentionScore} 分
                          </span>
                          <div className="score-bar">
                            <div
                              className="score-fill"
                              style={{ width: `${inattentionPercentage}%` }}
                            ></div>
                          </div>
                        </div>
                        <div className="symptom-interpretation">
                          得分 {Math.round(inattentionPercentage)}%
                          {inattentionPercentage <= 30
                            ? "，注意力集中能力良好，很少出现注意力分散的问题。"
                            : inattentionPercentage <= 60
                            ? "，存在轻到中度的注意力问题，在某些情况下可能难以集中注意力。"
                            : "，注意力问题较为严重，经常出现注意力不集中、容易分心的情况。"}
                        </div>
                      </div>

                      <div className="symptom-category">
                        <h4>多动冲动症状</h4>
                        <div className="symptom-score">
                          <span className="score-display">
                            {hyperactivity} / {maxHyperactivityScore} 分
                          </span>
                          <div className="score-bar">
                            <div
                              className="score-fill"
                              style={{ width: `${hyperactivityPercentage}%` }}
                            ></div>
                          </div>
                        </div>
                        <div className="symptom-interpretation">
                          得分 {Math.round(hyperactivityPercentage)}%
                          {hyperactivityPercentage <= 30
                            ? "，行为控制能力良好，很少出现冲动或过度活跃的行为。"
                            : hyperactivityPercentage <= 60
                            ? "，存在轻到中度的冲动控制问题，有时可能表现出坐立不安或冲动行为。"
                            : "，冲动控制问题较为严重，经常表现出多动、冲动或难以安静的行为。"}
                        </div>
                      </div>
                    </div>

                    <RadarChart testType={testType} results={results} />

                    <div className="personalized-analysis">
                      <h4>个性化分析</h4>
                      <div
                        className="personalized-content"
                        dangerouslySetInnerHTML={{
                          __html: personalizedAnalysis,
                        }}
                      ></div>
                    </div>

                    <div className="recommendations">
                      <h4>专业建议</h4>
                      <div
                        className="recommendation-content"
                        dangerouslySetInnerHTML={{
                          __html: analysis.recommendations,
                        }}
                      ></div>
                    </div>
                  </div>

                  <div className="result-actions">
                    <button className="btn-primary" onClick={onRetakeTest}>
                      重新测试
                    </button>
                    <button
                      className="btn-secondary"
                      onClick={() => window.print()}
                    >
                      保存结果
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // 分析函数
      function getResultAnalysis(testType, scores) {
        const { total } = scores;

        if (testType === "children") {
          if (total <= 18) {
            return {
              level: "低风险",
              description:
                "当前症状表现较轻微，ADHD的可能性较低。孩子的注意力和行为控制能力基本正常。",
              recommendations: `
                            <ul>
                                <li>继续保持良好的学习和生活习惯</li>
                                <li>适当增加体育锻炼和户外活动</li>
                                <li>建立规律的作息时间</li>
                                <li>鼓励孩子参与需要专注的活动，如阅读、拼图等</li>
                            </ul>
                        `,
            };
          } else if (total <= 36) {
            return {
              level: "中等风险",
              description:
                "存在一定程度的注意力或行为控制问题，建议密切关注孩子的表现，可考虑咨询专业医生。",
              recommendations: `
                            <ul>
                                <li><strong>建议咨询儿童心理医生或发育行为科医生</strong></li>
                                <li>建立更加结构化的日常routine</li>
                                <li>使用明确的指令和视觉提示</li>
                                <li>提供安静、无干扰的学习环境</li>
                                <li>适当分解复杂任务，给予及时的正面反馈</li>
                                <li>与学校老师保持密切沟通</li>
                            </ul>
                        `,
            };
          } else {
            return {
              level: "高风险",
              description:
                "症状表现明显，强烈建议尽快咨询专业医生进行进一步评估和诊断。",
              recommendations: `
                            <ul>
                                <li><strong>请尽快咨询儿童精神科医生或发育行为科医生</strong></li>
                                <li>准备详细的症状记录和学校反馈</li>
                                <li>考虑多学科评估（医生、心理师、教师联合评估）</li>
                                <li>了解学校的特殊教育资源和支持服务</li>
                                <li>学习ADHD相关知识，为可能的治疗做好准备</li>
                                <li>保持耐心和理解，避免过度批评孩子</li>
                            </ul>
                        `,
            };
          }
        } else {
          if (total <= 24) {
            return {
              level: "低风险",
              description:
                "当前症状表现较轻微，成人ADHD的可能性较低。您的注意力和冲动控制能力基本正常。",
              recommendations: `
                            <ul>
                                <li>保持良好的工作和生活习惯</li>
                                <li>使用时间管理工具提高效率</li>
                                <li>定期进行体育锻炼缓解压力</li>
                                <li>保证充足的睡眠和合理的营养</li>
                            </ul>
                        `,
            };
          } else if (total <= 48) {
            return {
              level: "中等风险",
              description:
                "存在一定程度的注意力缺陷或冲动控制问题，建议关注这些症状对日常生活的影响，可考虑咨询专业医生。",
              recommendations: `
                            <ul>
                                <li><strong>建议咨询精神科医生或心理医生</strong></li>
                                <li>使用任务管理App和提醒工具</li>
                                <li>创建无干扰的工作环境</li>
                                <li>学习正念冥想和放松技巧</li>
                                <li>建立规律的日常作息</li>
                                <li>与家人朋友分享您的困扰，获得支持</li>
                            </ul>
                        `,
            };
          } else {
            return {
              level: "高风险",
              description:
                "症状表现明显，强烈建议咨询专业医生进行全面评估。成人ADHD如果得到适当治疗，可以显著改善生活质量。",
              recommendations: `
                            <ul>
                                <li><strong>请尽快咨询精神科医生进行专业评估</strong></li>
                                <li>准备详细的症状历史和功能影响记录</li>
                                <li>了解成人ADHD的治疗选项（药物和非药物治疗）</li>
                                <li>考虑认知行为治疗(CBT)等心理治疗</li>
                                <li>寻找ADHD支持小组或在线社区</li>
                                <li>学习ADHD管理策略和生活技能</li>
                                <li>向雇主了解工作场所的合理调整政策</li>
                            </ul>
                        `,
            };
          }
        }
      }

      function getScoreInterpretation(testType, total, maxScore) {
        const percentage = Math.round((total / maxScore) * 100);

        let interpretation = `<p><strong>您的总分为 ${total} 分（满分 ${maxScore} 分），占总分的 ${percentage}%</strong></p>`;

        if (testType === "children") {
          interpretation += `
                    <div class="score-ranges">
                        <div class="score-range ${
                          total <= 18 ? "current" : ""
                        }">
                            <span class="range">0-18分</span>
                            <span class="level low-risk">低风险</span>
                            <span class="desc">症状轻微，ADHD可能性较低</span>
                        </div>
                        <div class="score-range ${
                          total > 18 && total <= 36 ? "current" : ""
                        }">
                            <span class="range">19-36分</span>
                            <span class="level medium-risk">中等风险</span>
                            <span class="desc">存在明显症状，建议专业评估</span>
                        </div>
                        <div class="score-range ${total > 36 ? "current" : ""}">
                            <span class="range">37-54分</span>
                            <span class="level high-risk">高风险</span>
                            <span class="desc">症状显著，强烈建议就医</span>
                        </div>
                    </div>
                `;
        } else {
          interpretation += `
                    <div class="score-ranges">
                        <div class="score-range ${
                          total <= 24 ? "current" : ""
                        }">
                            <span class="range">0-24分</span>
                            <span class="level low-risk">低风险</span>
                            <span class="desc">症状轻微，ADHD可能性较低</span>
                        </div>
                        <div class="score-range ${
                          total > 24 && total <= 48 ? "current" : ""
                        }">
                            <span class="range">25-48分</span>
                            <span class="level medium-risk">中等风险</span>
                            <span class="desc">存在明显症状，建议专业评估</span>
                        </div>
                        <div class="score-range ${total > 48 ? "current" : ""}">
                            <span class="range">49-72分</span>
                            <span class="level high-risk">高风险</span>
                            <span class="desc">症状显著，强烈建议就医</span>
                        </div>
                    </div>
                `;
        }

        return interpretation;
      }

      function getPersonalizedAnalysis(testType, scores) {
        const { total, inattention, hyperactivity } = scores;
        const testSubject = testType === "children" ? "孩子" : "您";

        let analysis = [];

        // 症状类型分析
        if (inattention > hyperactivity) {
          const diff = inattention - hyperactivity;
          if (diff >= 6) {
            analysis.push(
              `<span class="highlight">注意力不集中</span>是主要表现，${testSubject}更多地表现为难以集中注意力、容易分心、健忘等问题。`
            );
          } else {
            analysis.push(
              `${testSubject}的注意力问题和多动冲动问题都有所表现，但<span class="highlight">注意力不集中</span>稍微突出一些。`
            );
          }
        } else if (hyperactivity > inattention) {
          const diff = hyperactivity - inattention;
          if (diff >= 6) {
            analysis.push(
              `<span class="highlight">多动冲动</span>是主要表现，${testSubject}更多地表现为坐立不安、冲动行为、难以安静等问题。`
            );
          } else {
            analysis.push(
              `${testSubject}的注意力问题和多动冲动问题都有所表现，但<span class="highlight">多动冲动</span>稍微突出一些。`
            );
          }
        } else {
          analysis.push(
            `${testSubject}在注意力不集中和多动冲动两方面的表现<span class="highlight">相对均衡</span>，两类症状并存。`
          );
        }

        // 严重程度分析
        if (total >= (testType === "children" ? 42 : 60)) {
          analysis.push(
            `症状表现<span class="highlight">非常明显</span>，已经达到需要专业医疗干预的程度。`
          );
        } else if (total >= (testType === "children" ? 30 : 40)) {
          analysis.push(
            `症状表现<span class="highlight">比较明显</span>，建议寻求专业医生的评估和建议。`
          );
        } else if (total >= (testType === "children" ? 18 : 24)) {
          analysis.push(
            `症状表现<span class="highlight">轻度到中度</span>，需要关注并采取相应的管理措施。`
          );
        } else {
          analysis.push(
            `当前症状表现<span class="highlight">较轻</span>，但仍需保持关注。`
          );
        }

        // 功能影响评估
        if (testType === "adult") {
          if (total > 36) {
            analysis.push(
              `这些症状很可能已经对您的工作、学习或人际关系造成了<span class="highlight">显著影响</span>。`
            );
          } else if (total > 18) {
            analysis.push(
              `这些症状可能在某些情况下对您的日常生活造成<span class="highlight">一定影响</span>。`
            );
          }
        } else {
          if (total > 36) {
            analysis.push(
              `这些症状很可能已经对孩子的学习、社交或家庭生活造成了<span class="highlight">显著影响</span>。`
            );
          } else if (total > 18) {
            analysis.push(
              `这些症状可能在某些情况下对孩子的日常生活造成<span class="highlight">一定影响</span>。`
            );
          }
        }

        return analysis.join("<br><br>");
      }

      // 渲染应用
      ReactDOM.render(<ADHDTestApp />, document.getElementById("root"));
    </script>
  </body>
</html>
